server:
  host: 0.0.0.0
  port: 9444
  readtimeout: 15s
  writetimeout: 15s
  max_request_bytes: 10485760
  rate_limit_per_min: 600
  # Content Security Policy header for React UI compatibility
  # More restrictive CSP: "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'"
  content_security_policy: "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' data:; img-src 'self' data: blob:; connect-src 'self'; font-src 'self' data:; object-src 'none'; frame-ancestors 'none'; base-uri 'self'"
  security_headers:
    hsts:
      enabled: true
      max_age: 63072000
      include_subdomains: true
      preload: false
    permissions_policy: "geolocation=(); microphone=(); camera=()"
    coop: "same-origin"
    coep: "require-corp"
    corp: "same-origin"
  tls:
    cert_file: ""
    key_file: ""
    min_version: "1.2"

inputs:
  syslog:
    enabled: false
    host: 0.0.0.0
    port: 6514
    # Connection management
    allow_list: []  # IP/CIDR allow-list (empty = allow all). Example: ["192.168.0.0/24", "10.0.0.5"]
    idle_timeout: 5m  # drop idle connections after this duration (0 = no timeout)
    read_buffer_size: 65536  # per-connection buffer in bytes
    max_connections: 1000  # concurrent connection limit (0 = unlimited)
    verbose_logging: false  # enable detailed connection logging for troubleshooting Versa
    tls:
      cert_file: ""
      key_file: ""
      min_version: "1.2"
      cipher_suites: []  # optional: explicit TLS cipher names (empty = Go defaults)
      auto_cert:
        enabled: true
        hosts:
          - bibbl.local
        valid_days: 365
        renew_before_days: 30
        output_dir: ./certs/syslog
        common_name: "Bibbl Syslog AutoCert"
        # Share the generated .crt/.pem files with Versa SD-WAN firewalls for Syslog over TLS
  akamai_ds2:
    enabled: false # set true to enable default Akamai DataStream 2 polling source
    host: "example.luna.akamaiapis.net" # Akamai API base host (no protocol)
    client_token: ""
    client_secret: ""
    access_token: ""
    interval_seconds: 60
    # streams: "12345,67890" # optional list of stream IDs (comma separated or YAML array)

outputs:
  # Seeded automatically at startup (idempotent) but documented for clarity
  # sentinel:
  #   table_name: Custom_BibblLogs_CL
  azure_log_analytics:
    enabled: false
    workspace_id: ""
    shared_key: "vault://secret/data/bibbl#sharedKey"
    log_type: "BibblLogs"
    resource_group: ""
    resource_id: ""
    batch_max_events: 500
    batch_max_bytes: 1048576
    flush_interval_sec: 10
    concurrency: 2
    max_retries: 3
    retry_delay_sec: 2
    spill:
      enabled: true
      directory: ./data/spill/azure
      max_bytes: 10737418240
      segment_size: 1048576
      encrypt: false
      key_env: BIBBL_SPILL_KEY
  azure_datalake:
    storage_account: "<account>" # Azure Storage account name
    filesystem: "logs"          # ADLS Gen2 filesystem (container) name
    directory: "bibbl/raw"      # Optional base directory path
    path_template: "bibbl/raw/${yyyy}/${MM}/${dd}/${HH}/data-${mm}.jsonl" # simple token expansion plan
    format: jsonl                # future: parquet

secrets:
  vault:
    enabled: true
    address: http://vault:8200
    namespace: ""
    mount_path: secret
    kv_version: 2
    token: dev-root-token
    cache_ttl: 5m
    request_timeout: 10s
    tls_skip_verify: true
    tls:
      ca_file: ""
      cert_file: ""
      key_file: ""

telemetry:
  otlp:
    endpoint: ""
    headers: {}
    insecure: false
    compression: gzip
    timeout: 10s
    sample_ratio: 1.0

# Pipelines are managed through the API/UI, but filter functions follow the same syntax used in
# the web console. Example payload for reference:
# pipelines:
#   - name: "High severity"
#     description: "Ship only critical/high/med"
#     functions:
#       - "Parse Versa KVP"
#       - "filter:severity=critical|high|med"
